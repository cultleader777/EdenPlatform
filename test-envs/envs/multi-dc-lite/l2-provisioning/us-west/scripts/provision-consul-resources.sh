#!/bin/sh

ORIGINAL_B64=$( echo -n PGh0bWw+CjxoZWFkPgo8L2hlYWQ+Cjxib2R5Pgo8aDE+RWRlbiBQbGF0Zm9ybSBhZG1pbiBwYW5lbDwvaDE+CjxoMz5BbGVydG1hbmFnZXI8L2gzPgo8dWw+CjxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iaHR0cHM6Ly9hZG0tYWxlcnRtYW5hZ2VyLWRlZmF1bHQuZXBsLWluZnJhLm5ldCI+ZGVmYXVsdDwvYT48L2xpPjwvdWw+CjxoMz5Db25zdWw8L2gzPgo8dWw+CjxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iaHR0cHM6Ly9hZG0tY29uc3VsLXVzLXdlc3QuZXBsLWluZnJhLm5ldCI+dXMtd2VzdDwvYT48L2xpPjwvdWw+CjxoMz5HcmFmYW5hPC9oMz4KPHVsPgo8bGk+PGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHBzOi8vYWRtLWdyYWZhbmEtbWFpbi5lcGwtaW5mcmEubmV0Ij5tYWluPC9hPjwvbGk+PC91bD4KPGgzPk1pbklPIGNsdXN0ZXJzPC9oMz4KPHVsPgo8bGk+PGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Imh0dHBzOi8vYWRtLW1pbmlvLWdsb2JhbC5lcGwtaW5mcmEubmV0Ij5nbG9iYWw8L2E+PC9saT48L3VsPgo8aDM+Tm9tYWQ8L2gzPgo8dWw+CjxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iaHR0cHM6Ly9hZG0tbm9tYWQtdXMtd2VzdC5lcGwtaW5mcmEubmV0Ij51cy13ZXN0PC9hPjwvbGk+PC91bD4KPGgzPlByb21ldGhldXMgY2x1c3RlcnM8L2gzPgo8dWw+CjxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iaHR0cHM6Ly9hZG0tcHJvbWV0aGV1cy1kZWZhdWx0LmVwbC1pbmZyYS5uZXQiPmRlZmF1bHQ8L2E+PC9saT48L3VsPgo8aDM+VmF1bHQ8L2gzPgo8dWw+CjxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iaHR0cHM6Ly9hZG0tdmF1bHQtdXMtd2VzdC5lcGwtaW5mcmEubmV0Ij51cy13ZXN0PC9hPjwvbGk+PC91bD4KPC9ib2R5Pgo8L2h0bWw+Cg== )
CURRENT_B64=$( consul kv get epl-kv/admin-site-html | gunzip | base64 -w 0 || true )
if [ "$ORIGINAL_B64" != "$CURRENT_B64" ]
then
  THE_VALUE=$( echo -n $ORIGINAL_B64 | base64 -d | gzip -9 | base64 -w 0 )
  consul kv put -base64 epl-kv/admin-site-html $THE_VALUE
else
  echo epl-kv/admin-site-html is up to date
fi
ORIGINAL_B64=$( echo -n CnBjcmVfaml0IG9uOwoKd29ya2VyX3Byb2Nlc3NlcyA0Owp3b3JrZXJfcmxpbWl0X25vZmlsZSAxMjI4ODsKCmV2ZW50cyB7CiAgICB3b3JrZXJfY29ubmVjdGlvbnMgIDEwMjQ7Cn0KCmh0dHAgewogICAgaW5jbHVkZSAgICAgICAvZXRjL29wZW5yZXN0eS9taW1lLnR5cGVzOwogICAgZGVmYXVsdF90eXBlICBhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07CiAgICAjIHN0YXJ0ZWQgZmFpbGluZyBpbiBhY3R1YWwgZW52CiAgICBzZXJ2ZXJfbmFtZXNfaGFzaF9idWNrZXRfc2l6ZSAxMjg7CgogICAgIyBmb3Igd2Vic29ja2V0cwogICAgbWFwICRodHRwX3VwZ3JhZGUgJGNvbm5lY3Rpb25fdXBncmFkZSB7CiAgICAgICAgZGVmYXVsdCB1cGdyYWRlOwogICAgICAgICcnIGNsb3NlOwogICAgfQoKICAgICMgTG9nIGluIEpTT04gRm9ybWF0CiAgICBsb2dfZm9ybWF0IG5naW54bG9nX2pzb24gZXNjYXBlPWpzb24gJ3sgIkB0aW1lc3RhbXAiOiAiJHRpbWVfaXNvODYwMSIsICcKICAgICAgICAgJyJyZW1vdGVfYWRkciI6ICIkcmVtb3RlX2FkZHIiLCAnCiAgICAgICAgICciYm9keV9ieXRlc19zZW50IjogJGJvZHlfYnl0ZXNfc2VudCwgJwogICAgICAgICAnImd6aXBfcmF0aW8iOiAiJGd6aXBfcmF0aW8iLCAnCiAgICAgICAgICcicmVxdWVzdF90aW1lIjogJHJlcXVlc3RfdGltZSwgJwogICAgICAgICAnInVwc3RyZWFtX3Jlc3BvbnNlX3RpbWUiOiAkdXBzdHJlYW1fcmVzcG9uc2VfdGltZSwgJwogICAgICAgICAnInJlc3BvbnNlX3N0YXR1cyI6ICRzdGF0dXMsICcKICAgICAgICAgJyJyZXF1ZXN0IjogIiRyZXF1ZXN0IiwgJwogICAgICAgICAnInJlcXVlc3RfbWV0aG9kIjogIiRyZXF1ZXN0X21ldGhvZCIsICcKICAgICAgICAgJyJob3N0IjogIiRob3N0IiwnCiAgICAgICAgICcidXBzdHJlYW1fYWRkciI6ICIkdXBzdHJlYW1fYWRkciIsJwogICAgICAgICAnImh0dHBfeF9mb3J3YXJkZWRfZm9yIjogIiRodHRwX3hfZm9yd2FyZGVkX2ZvciIsJwogICAgICAgICAnImh0dHBfcmVmZXJyZXIiOiAiJGh0dHBfcmVmZXJlciIsICcKICAgICAgICAgJyJodHRwX3VzZXJfYWdlbnQiOiAiJGh0dHBfdXNlcl9hZ2VudCIsICcKICAgICAgICAgJyJodHRwX3ZlcnNpb24iOiAiJHNlcnZlcl9wcm90b2NvbCIsICcKICAgICAgICAgJyJzZXJ2ZXJfcG9ydCI6ICIkc2VydmVyX3BvcnQifSc7CiAgICBhY2Nlc3NfbG9nIC9kZXYvc3Rkb3V0IG5naW54bG9nX2pzb247CgogICAgIyBTZWUgTW92ZSBkZWZhdWx0IHdyaXRhYmxlIHBhdGhzIHRvIGEgZGVkaWNhdGVkIGRpcmVjdG9yeSAoIzExOSkKICAgICMgaHR0cHM6Ly9naXRodWIuY29tL29wZW5yZXN0eS9kb2NrZXItb3BlbnJlc3R5L2lzc3Vlcy8xMTkKICAgIGNsaWVudF9ib2R5X3RlbXBfcGF0aCAvdmFyL3J1bi9vcGVucmVzdHkvbmdpbngtY2xpZW50LWJvZHk7CiAgICBwcm94eV90ZW1wX3BhdGggICAgICAgL3Zhci9ydW4vb3BlbnJlc3R5L25naW54LXByb3h5OwogICAgZmFzdGNnaV90ZW1wX3BhdGggICAgIC92YXIvcnVuL29wZW5yZXN0eS9uZ2lueC1mYXN0Y2dpOwogICAgdXdzZ2lfdGVtcF9wYXRoICAgICAgIC92YXIvcnVuL29wZW5yZXN0eS9uZ2lueC11d3NnaTsKICAgIHNjZ2lfdGVtcF9wYXRoICAgICAgICAvdmFyL3J1bi9vcGVucmVzdHkvbmdpbngtc2NnaTsKCiAgICBzZW5kZmlsZSAgICAgICAgb247CgogICAga2VlcGFsaXZlX3RpbWVvdXQgIDY1OwoKICAgIGd6aXAgIG9uOwogICAgZ3ppcF9wcm94aWVkIG5vLWNhY2hlIG5vLXN0b3JlIHByaXZhdGUgZXhwaXJlZCBhdXRoOwogICAgZ3ppcF90eXBlcyBhcHBsaWNhdGlvbi9qc29uIHRleHQvaHRtbDsKCiAgICBpbmNsdWRlIC9zZWNyZXRzL3Byb20tc2VydmVyLmNvbmY7CgoKICAgIGx1YV9zaGFyZWRfZGljdCBwcm9tZXRoZXVzX21ldHJpY3MgMTBNOwogICAgbHVhX3BhY2thZ2VfcGF0aCAnL2xvY2FsLz8ubHVhOzsnOwoKICAgIGluaXRfd29ya2VyX2J5X2x1YV9ibG9jayB7CiAgICAgIHByb21ldGhldXMgPSByZXF1aXJlKCJwcm9tZXRoZXVzIikuaW5pdCgicHJvbWV0aGV1c19tZXRyaWNzIikKCiAgICAgIG1ldHJpY19yZXF1ZXN0cyA9IHByb21ldGhldXM6Y291bnRlcigKICAgICAgICAibmdpbnhfaHR0cF9yZXF1ZXN0c190b3RhbCIsICJOdW1iZXIgb2YgSFRUUCByZXF1ZXN0cyIsIHsiaG9zdCIsICJzdGF0dXMifSkKICAgICAgbWV0cmljX2xhdGVuY3kgPSBwcm9tZXRoZXVzOmhpc3RvZ3JhbSgKICAgICAgICAibmdpbnhfaHR0cF9yZXF1ZXN0X2R1cmF0aW9uX3NlY29uZHMiLCAiSFRUUCByZXF1ZXN0IGxhdGVuY3kiLCB7Imhvc3QifSkKICAgICAgbWV0cmljX2Nvbm5lY3Rpb25zID0gcHJvbWV0aGV1czpnYXVnZSgKICAgICAgICAibmdpbnhfaHR0cF9jb25uZWN0aW9ucyIsICJOdW1iZXIgb2YgSFRUUCBjb25uZWN0aW9ucyIsIHsic3RhdGUifSkKICAgICAgbWV0cmljX3Jlc3BvbnNlX3NpemVzID0gcHJvbWV0aGV1czpoaXN0b2dyYW0oCiAgICAgICAgIm5naW54X2h0dHBfcmVzcG9uc2Vfc2l6ZV9ieXRlcyIsICJTaXplIG9mIEhUVFAgcmVzcG9uc2VzIiwgbmlsLAogICAgICAgIHsxMCwxMDAsMTAwMCwxMDAwMCwxMDAwMDAsMTAwMDAwMH0pCiAgICB9CgogICAgbG9nX2J5X2x1YV9ibG9jayB7CiAgICAgIG1ldHJpY19yZXF1ZXN0czppbmMoMSwge25neC52YXIuc2VydmVyX25hbWUsIG5neC52YXIuc3RhdHVzfSkKICAgICAgbWV0cmljX2xhdGVuY3k6b2JzZXJ2ZSh0b251bWJlcihuZ3gudmFyLnJlcXVlc3RfdGltZSksIHtuZ3gudmFyLnNlcnZlcl9uYW1lfSkKICAgICAgbWV0cmljX3Jlc3BvbnNlX3NpemVzOm9ic2VydmUodG9udW1iZXIobmd4LnZhci5ieXRlc19zZW50KSkKICAgIH0KCgpzZXJ2ZXIgewogICAgbGlzdGVuIDgwOwogICAgbGlzdGVuIFs6Ol06ODA7CiAgICBzZXJ2ZXJfbmFtZSBfOwogICAgcmV0dXJuIDMwMSBodHRwczovLyRob3N0JHJlcXVlc3RfdXJpOwp9CgpzZXJ2ZXIgewogICAgbGlzdGVuIDgwOwogICAgbGlzdGVuIFs6Ol06ODA7CiAgICBzZXJ2ZXJfbmFtZSBhZG1pbi5lcGwtaW5mcmEubmV0OwogICAgcmV0dXJuIDMwMSBodHRwczovLyRob3N0JHJlcXVlc3RfdXJpOwp9CgpzZXJ2ZXIgewogICAgcmVzb2x2ZXIgMTI3LjAuMC4xOjUzIHZhbGlkPTEwczsKCiAgICBsaXN0ZW4gNDQzIHNzbDsKICAgIGxpc3RlbiBbOjpdOjQ0MyBzc2w7CgogICAgYXV0aF9iYXNpYyAiQWRtaW5pc3RyYXRvciBBcmVhIjsKICAgIGF1dGhfYmFzaWNfdXNlcl9maWxlIC9sb2NhbC9hZG1pbl9odHBhc3N3ZF9maWxlOwoKICAgIHNlcnZlcl9uYW1lIGFkbWluLmVwbC1pbmZyYS5uZXQ7CgogICAgc3NsX2NpcGhlcnMgRUNESEUtRUNEU0EtQUVTMjU2LUdDTS1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLUVDRFNBLUNIQUNIQTIwLVBPTFkxMzA1OkVDREhFLVJTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1FQ0RTQS1BRVMxMjgtR0NNLVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtRUNEU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1SU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1FQ0RTQS1BRVMxMjgtU0hBMjU2OkVDREhFLVJTQS1BRVMxMjgtU0hBMjU2OwoKICAgIHNzbF9jZXJ0aWZpY2F0ZSAvZXRjL3NzbC9wdWJsaWNfdGxzX2NlcnQucGVtOwogICAgc3NsX2NlcnRpZmljYXRlX2tleSAvZXRjL3NzbC9wdWJsaWNfdGxzX2tleS5wZW07CgoKICAgIGxvY2F0aW9uIC8gewogICAgICAgIHJvb3QgL2xvY2FsL3d3dy87CiAgICB9Cn0KCnNlcnZlciB7CiAgICBsaXN0ZW4gODA7CiAgICBsaXN0ZW4gWzo6XTo4MDsKICAgIHNlcnZlcl9uYW1lIGFkbS1hbGVydG1hbmFnZXItZGVmYXVsdC5lcGwtaW5mcmEubmV0OwogICAgcmV0dXJuIDMwMSBodHRwczovLyRob3N0JHJlcXVlc3RfdXJpOwp9CgpzZXJ2ZXIgewogICAgcmVzb2x2ZXIgMTI3LjAuMC4xOjUzIHZhbGlkPTEwczsKICAgIGxpc3RlbiA0NDMgc3NsOwogICAgbGlzdGVuIFs6Ol06NDQzIHNzbDsKICAgIHNlcnZlcl9uYW1lIGFkbS1hbGVydG1hbmFnZXItZGVmYXVsdC5lcGwtaW5mcmEubmV0OwoKICAgIGF1dGhfYmFzaWMgIkFkbWluaXN0cmF0b3IgQXJlYSI7CiAgICBhdXRoX2Jhc2ljX3VzZXJfZmlsZSAvbG9jYWwvYWRtaW5faHRwYXNzd2RfZmlsZTsKICAgIHNzbF9jaXBoZXJzIEVDREhFLUVDRFNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLVJTQS1BRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1FQ0RTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1SU0EtQ0hBQ0hBMjAtUE9MWTEzMDU6RUNESEUtRUNEU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtUlNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLUVDRFNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtRUNEU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LVNIQTI1NjsKCiAgICBzc2xfY2VydGlmaWNhdGUgL2V0Yy9zc2wvcHVibGljX3Rsc19jZXJ0LnBlbTsKICAgIHNzbF9jZXJ0aWZpY2F0ZV9rZXkgL2V0Yy9zc2wvcHVibGljX3Rsc19rZXkucGVtOwoKICAgIGxvY2F0aW9uIH4gXi8gewogICAgICAgIHByb3h5X2h0dHBfdmVyc2lvbiAxLjE7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlICRodHRwX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uICRjb25uZWN0aW9uX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0OwogICAgICAgIHNldCAkZHVtbXlfdmFyIGVwbC1tb24tZGVmYXVsdC1hbGVydG1hbmFnZXIuc2VydmljZS5jb25zdWw6OTA5MjsKICAgICAgICBwcm94eV9wYXNzIGh0dHA6Ly8kZHVtbXlfdmFyOwogICAgfQoKfQoKCnNlcnZlciB7CiAgICBsaXN0ZW4gODA7CiAgICBsaXN0ZW4gWzo6XTo4MDsKICAgIHNlcnZlcl9uYW1lIGFkbS1jb25zdWwtdXMtd2VzdC5lcGwtaW5mcmEubmV0OwogICAgcmV0dXJuIDMwMSBodHRwczovLyRob3N0JHJlcXVlc3RfdXJpOwp9CgpzZXJ2ZXIgewogICAgcmVzb2x2ZXIgMTI3LjAuMC4xOjUzIHZhbGlkPTEwczsKICAgIGxpc3RlbiA0NDMgc3NsOwogICAgbGlzdGVuIFs6Ol06NDQzIHNzbDsKICAgIHNlcnZlcl9uYW1lIGFkbS1jb25zdWwtdXMtd2VzdC5lcGwtaW5mcmEubmV0OwoKICAgIGF1dGhfYmFzaWMgIkFkbWluaXN0cmF0b3IgQXJlYSI7CiAgICBhdXRoX2Jhc2ljX3VzZXJfZmlsZSAvbG9jYWwvYWRtaW5faHRwYXNzd2RfZmlsZTsKICAgIHNzbF9jaXBoZXJzIEVDREhFLUVDRFNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLVJTQS1BRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1FQ0RTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1SU0EtQ0hBQ0hBMjAtUE9MWTEzMDU6RUNESEUtRUNEU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtUlNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLUVDRFNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtRUNEU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LVNIQTI1NjsKCiAgICBzc2xfY2VydGlmaWNhdGUgL2V0Yy9zc2wvcHVibGljX3Rsc19jZXJ0LnBlbTsKICAgIHNzbF9jZXJ0aWZpY2F0ZV9rZXkgL2V0Yy9zc2wvcHVibGljX3Rsc19rZXkucGVtOwoKICAgIGxvY2F0aW9uIH4gXi8gewogICAgICAgIHByb3h5X2h0dHBfdmVyc2lvbiAxLjE7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlICRodHRwX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uICRjb25uZWN0aW9uX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0OwogICAgICAgIHNldCAkZHVtbXlfdmFyIGNvbnN1bC5zZXJ2aWNlLmNvbnN1bDo4NTAxOwogICAgICAgIHByb3h5X3Bhc3MgaHR0cHM6Ly8kZHVtbXlfdmFyOwoKICAgICAgICBsb2NhdGlvbiB+KiBeL3VpL2Fzc2V0cy8uKiB7CiAgICAgICAgICAgIGV4cGlyZXMgMzBkOwogICAgICAgICAgICBhZGRfaGVhZGVyIENhY2hlLUNvbnRyb2wgcHJpdmF0ZTsKICAgICAgICAgICAgcHJveHlfcGFzcyBodHRwczovLyRkdW1teV92YXI7CiAgICAgICAgfQogICAgfQoKfQoKCnNlcnZlciB7CiAgICBsaXN0ZW4gODA7CiAgICBsaXN0ZW4gWzo6XTo4MDsKICAgIHNlcnZlcl9uYW1lIGFkbS1ncmFmYW5hLW1haW4uZXBsLWluZnJhLm5ldDsKICAgIHJldHVybiAzMDEgaHR0cHM6Ly8kaG9zdCRyZXF1ZXN0X3VyaTsKfQoKc2VydmVyIHsKICAgIHJlc29sdmVyIDEyNy4wLjAuMTo1MyB2YWxpZD0xMHM7CiAgICBsaXN0ZW4gNDQzIHNzbDsKICAgIGxpc3RlbiBbOjpdOjQ0MyBzc2w7CiAgICBzZXJ2ZXJfbmFtZSBhZG0tZ3JhZmFuYS1tYWluLmVwbC1pbmZyYS5uZXQ7CiAgICBzc2xfY2lwaGVycyBFQ0RIRS1FQ0RTQS1BRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1SU0EtQUVTMjU2LUdDTS1TSEEzODQ6RUNESEUtRUNEU0EtQ0hBQ0hBMjAtUE9MWTEzMDU6RUNESEUtUlNBLUNIQUNIQTIwLVBPTFkxMzA1OkVDREhFLUVDRFNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLVJTQS1BRVMxMjgtR0NNLVNIQTI1NjpFQ0RIRS1FQ0RTQS1BRVMyNTYtU0hBMzg0OkVDREhFLVJTQS1BRVMyNTYtU0hBMzg0OkVDREhFLUVDRFNBLUFFUzEyOC1TSEEyNTY6RUNESEUtUlNBLUFFUzEyOC1TSEEyNTY7CgogICAgc3NsX2NlcnRpZmljYXRlIC9ldGMvc3NsL3B1YmxpY190bHNfY2VydC5wZW07CiAgICBzc2xfY2VydGlmaWNhdGVfa2V5IC9ldGMvc3NsL3B1YmxpY190bHNfa2V5LnBlbTsKCiAgICBsb2NhdGlvbiB+IF4vIHsKICAgICAgICBwcm94eV9odHRwX3ZlcnNpb24gMS4xOwogICAgICAgIHByb3h5X3NldF9oZWFkZXIgVXBncmFkZSAkaHR0cF91cGdyYWRlOwogICAgICAgIHByb3h5X3NldF9oZWFkZXIgQ29ubmVjdGlvbiAkY29ubmVjdGlvbl91cGdyYWRlOwogICAgICAgIHByb3h5X3NldF9oZWFkZXIgSG9zdCAkaG9zdDsKICAgICAgICBzZXQgJGR1bW15X3ZhciBlcGwtZ3JhZmFuYS1tYWluLnNlcnZpY2UuY29uc3VsOjMwMDA7CiAgICAgICAgcHJveHlfcGFzcyBodHRwOi8vJGR1bW15X3ZhcjsKICAgIH0KCn0KCgpzZXJ2ZXIgewogICAgbGlzdGVuIDgwOwogICAgbGlzdGVuIFs6Ol06ODA7CiAgICBzZXJ2ZXJfbmFtZSBhZG0tbWluaW8tZ2xvYmFsLmVwbC1pbmZyYS5uZXQ7CiAgICByZXR1cm4gMzAxIGh0dHBzOi8vJGhvc3QkcmVxdWVzdF91cmk7Cn0KCnNlcnZlciB7CiAgICByZXNvbHZlciAxMjcuMC4wLjE6NTMgdmFsaWQ9MTBzOwogICAgbGlzdGVuIDQ0MyBzc2w7CiAgICBsaXN0ZW4gWzo6XTo0NDMgc3NsOwogICAgc2VydmVyX25hbWUgYWRtLW1pbmlvLWdsb2JhbC5lcGwtaW5mcmEubmV0OwogICAgc3NsX2NpcGhlcnMgRUNESEUtRUNEU0EtQUVTMjU2LUdDTS1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLUVDRFNBLUNIQUNIQTIwLVBPTFkxMzA1OkVDREhFLVJTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1FQ0RTQS1BRVMxMjgtR0NNLVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtRUNEU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1SU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1FQ0RTQS1BRVMxMjgtU0hBMjU2OkVDREhFLVJTQS1BRVMxMjgtU0hBMjU2OwoKICAgIHNzbF9jZXJ0aWZpY2F0ZSAvZXRjL3NzbC9wdWJsaWNfdGxzX2NlcnQucGVtOwogICAgc3NsX2NlcnRpZmljYXRlX2tleSAvZXRjL3NzbC9wdWJsaWNfdGxzX2tleS5wZW07CgogICAgbG9jYXRpb24gfiBeLyB7CiAgICAgICAgcHJveHlfaHR0cF92ZXJzaW9uIDEuMTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFVwZ3JhZGUgJGh0dHBfdXBncmFkZTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gJGNvbm5lY3Rpb25fdXBncmFkZTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgJGhvc3Q7CiAgICAgICAgc2V0ICRkdW1teV92YXIgZXBsLW1pbmlvLWdsb2JhbC5zZXJ2aWNlLmNvbnN1bDo5MDAxOwogICAgICAgIHByb3h5X3Bhc3MgaHR0cDovLyRkdW1teV92YXI7CiAgICB9Cgp9CgoKc2VydmVyIHsKICAgIGxpc3RlbiA4MDsKICAgIGxpc3RlbiBbOjpdOjgwOwogICAgc2VydmVyX25hbWUgYWRtLW5vbWFkLXVzLXdlc3QuZXBsLWluZnJhLm5ldDsKICAgIHJldHVybiAzMDEgaHR0cHM6Ly8kaG9zdCRyZXF1ZXN0X3VyaTsKfQoKc2VydmVyIHsKICAgIHJlc29sdmVyIDEyNy4wLjAuMTo1MyB2YWxpZD0xMHM7CiAgICBsaXN0ZW4gNDQzIHNzbDsKICAgIGxpc3RlbiBbOjpdOjQ0MyBzc2w7CiAgICBzZXJ2ZXJfbmFtZSBhZG0tbm9tYWQtdXMtd2VzdC5lcGwtaW5mcmEubmV0OwoKICAgIGF1dGhfYmFzaWMgIkFkbWluaXN0cmF0b3IgQXJlYSI7CiAgICBhdXRoX2Jhc2ljX3VzZXJfZmlsZSAvbG9jYWwvYWRtaW5faHRwYXNzd2RfZmlsZTsKICAgIHNzbF9jaXBoZXJzIEVDREhFLUVDRFNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLVJTQS1BRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1FQ0RTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1SU0EtQ0hBQ0hBMjAtUE9MWTEzMDU6RUNESEUtRUNEU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtUlNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLUVDRFNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtRUNEU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LVNIQTI1NjsKCiAgICBzc2xfY2VydGlmaWNhdGUgL2V0Yy9zc2wvcHVibGljX3Rsc19jZXJ0LnBlbTsKICAgIHNzbF9jZXJ0aWZpY2F0ZV9rZXkgL2V0Yy9zc2wvcHVibGljX3Rsc19rZXkucGVtOwoKICAgIGxvY2F0aW9uIH4gXi8gewogICAgICAgIHByb3h5X2J1ZmZlcmluZyBvZmY7CiAgICAgICAgcHJveHlfcmVhZF90aW1lb3V0IDMxMHM7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Gb3IgJHByb3h5X2FkZF94X2ZvcndhcmRlZF9mb3I7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBPcmlnaW4gIiR7c2NoZW1lfTovLyR7cHJveHlfaG9zdH0iOwogICAgICAgIHByb3h5X2h0dHBfdmVyc2lvbiAxLjE7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlICRodHRwX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uICRjb25uZWN0aW9uX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0OwogICAgICAgIHNldCAkZHVtbXlfdmFyIG5vbWFkLXNlcnZlcnMuc2VydmljZS5jb25zdWw6NDY0NjsKICAgICAgICBwcm94eV9wYXNzIGh0dHBzOi8vJGR1bW15X3ZhcjsKICAgIH0KCn0KCgpzZXJ2ZXIgewogICAgbGlzdGVuIDgwOwogICAgbGlzdGVuIFs6Ol06ODA7CiAgICBzZXJ2ZXJfbmFtZSBhZG0tcHJvbWV0aGV1cy1kZWZhdWx0LmVwbC1pbmZyYS5uZXQ7CiAgICByZXR1cm4gMzAxIGh0dHBzOi8vJGhvc3QkcmVxdWVzdF91cmk7Cn0KCnNlcnZlciB7CiAgICByZXNvbHZlciAxMjcuMC4wLjE6NTMgdmFsaWQ9MTBzOwogICAgbGlzdGVuIDQ0MyBzc2w7CiAgICBsaXN0ZW4gWzo6XTo0NDMgc3NsOwogICAgc2VydmVyX25hbWUgYWRtLXByb21ldGhldXMtZGVmYXVsdC5lcGwtaW5mcmEubmV0OwoKICAgIGF1dGhfYmFzaWMgIkFkbWluaXN0cmF0b3IgQXJlYSI7CiAgICBhdXRoX2Jhc2ljX3VzZXJfZmlsZSAvbG9jYWwvYWRtaW5faHRwYXNzd2RfZmlsZTsKICAgIHNzbF9jaXBoZXJzIEVDREhFLUVDRFNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLVJTQS1BRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1FQ0RTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1SU0EtQ0hBQ0hBMjAtUE9MWTEzMDU6RUNESEUtRUNEU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtUlNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLUVDRFNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtRUNEU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LVNIQTI1NjsKCiAgICBzc2xfY2VydGlmaWNhdGUgL2V0Yy9zc2wvcHVibGljX3Rsc19jZXJ0LnBlbTsKICAgIHNzbF9jZXJ0aWZpY2F0ZV9rZXkgL2V0Yy9zc2wvcHVibGljX3Rsc19rZXkucGVtOwoKICAgIGxvY2F0aW9uIH4gXi8gewogICAgICAgIHByb3h5X2h0dHBfdmVyc2lvbiAxLjE7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlICRodHRwX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uICRjb25uZWN0aW9uX3VwZ3JhZGU7CiAgICAgICAgcHJveHlfc2V0X2hlYWRlciBIb3N0ICRob3N0OwogICAgICAgIHNldCAkZHVtbXlfdmFyIGVwbC1tb24tZGVmYXVsdC1wcm9tZXRoZXVzLnNlcnZpY2UuY29uc3VsOjkwOTA7CiAgICAgICAgcHJveHlfcGFzcyBodHRwOi8vJGR1bW15X3ZhcjsKICAgIH0KCn0KCgpzZXJ2ZXIgewogICAgbGlzdGVuIDgwOwogICAgbGlzdGVuIFs6Ol06ODA7CiAgICBzZXJ2ZXJfbmFtZSBhZG0tdmF1bHQtdXMtd2VzdC5lcGwtaW5mcmEubmV0OwogICAgcmV0dXJuIDMwMSBodHRwczovLyRob3N0JHJlcXVlc3RfdXJpOwp9CgpzZXJ2ZXIgewogICAgcmVzb2x2ZXIgMTI3LjAuMC4xOjUzIHZhbGlkPTEwczsKICAgIGxpc3RlbiA0NDMgc3NsOwogICAgbGlzdGVuIFs6Ol06NDQzIHNzbDsKICAgIHNlcnZlcl9uYW1lIGFkbS12YXVsdC11cy13ZXN0LmVwbC1pbmZyYS5uZXQ7CgogICAgYXV0aF9iYXNpYyAiQWRtaW5pc3RyYXRvciBBcmVhIjsKICAgIGF1dGhfYmFzaWNfdXNlcl9maWxlIC9sb2NhbC9hZG1pbl9odHBhc3N3ZF9maWxlOwogICAgc3NsX2NpcGhlcnMgRUNESEUtRUNEU0EtQUVTMjU2LUdDTS1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1HQ00tU0hBMzg0OkVDREhFLUVDRFNBLUNIQUNIQTIwLVBPTFkxMzA1OkVDREhFLVJTQS1DSEFDSEEyMC1QT0xZMTMwNTpFQ0RIRS1FQ0RTQS1BRVMxMjgtR0NNLVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LUdDTS1TSEEyNTY6RUNESEUtRUNEU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1SU0EtQUVTMjU2LVNIQTM4NDpFQ0RIRS1FQ0RTQS1BRVMxMjgtU0hBMjU2OkVDREhFLVJTQS1BRVMxMjgtU0hBMjU2OwoKICAgIHNzbF9jZXJ0aWZpY2F0ZSAvZXRjL3NzbC9wdWJsaWNfdGxzX2NlcnQucGVtOwogICAgc3NsX2NlcnRpZmljYXRlX2tleSAvZXRjL3NzbC9wdWJsaWNfdGxzX2tleS5wZW07CgogICAgbG9jYXRpb24gfiBeLyB7CiAgICAgICAgcHJveHlfaHR0cF92ZXJzaW9uIDEuMTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIFVwZ3JhZGUgJGh0dHBfdXBncmFkZTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIENvbm5lY3Rpb24gJGNvbm5lY3Rpb25fdXBncmFkZTsKICAgICAgICBwcm94eV9zZXRfaGVhZGVyIEhvc3QgJGhvc3Q7CiAgICAgICAgc2V0ICRkdW1teV92YXIgdmF1bHQuc2VydmljZS5jb25zdWw6ODIwMDsKICAgICAgICBwcm94eV9wYXNzIGh0dHBzOi8vJGR1bW15X3ZhcjsKICAgIH0KCn0KCgp9Cg== )
CURRENT_B64=$( consul kv get epl-kv/external-elb-conf | gunzip | base64 -w 0 || true )
if [ "$ORIGINAL_B64" != "$CURRENT_B64" ]
then
  THE_VALUE=$( echo -n $ORIGINAL_B64 | base64 -d | gzip -9 | base64 -w 0 )
  consul kv put -base64 epl-kv/external-elb-conf $THE_VALUE
else
  echo epl-kv/external-elb-conf is up to date
fi
